# Git Strategies

## Atomic Commits（意味単位のコミット）

1コミット = 1つの意味のある変更。以下のテストを満たすこと：

- **読める**: diff を見て「何をしたか」が30秒で分かる
- **戻せる**: このコミットだけ revert しても壊れない
- **説明できる**: コミットメッセージが1行で書ける

### やるべき分割

| 状況 | 分割方法 |
| --- | --- |
| 新しいファイル3個+既存修正2個 | ファイル作成 → 既存修正 の2コミット |
| リファクタ + 機能追加 | リファクタ → 機能追加 の2コミット |
| バグ修正 + テスト追加 | 修正 → テスト の2コミット |
| lint 修正が混ざった | lint → 本体 の2コミット |

### やってはいけないこと

- ❌ 「とりあえず全部 add して commit」
- ❌ 1コミットに3つ以上の異なる関心事
- ❌ コミットメッセージに "and" が2回以上出る

## Branch Strategy（ブランチ運用）

### 最重要ルール

**main は受け取るだけ。変更は常に外で始める。**

```
main ← マージだけ。直接コミットしない
 └── feat/xxx ← 機能開発
 └── fix/xxx ← バグ修正
 └── docs/xxx ← ドキュメント
```

### 手順

1. **作業開始 → まずブランチを切る**: `git checkout -b feat/xxx`
2. **1ブランチ = 1目的**（機能、修正、リファクタ）
3. 完了 → main にマージ + ブランチ削除
4. main に直接コミットしていい例外: **typo 修正のみ**

### ブランチを切るタイミング

| 状況 | ブランチ |
| --- | --- |
| 新機能の開発 | `feat/add-xxx` |
| バグ修正 | `fix/resolve-xxx` |
| 実験的な変更 | `experiment/try-xxx` |
| main で直接やっていい | typo 修正、1行の docs 変更のみ |

### マージ前チェック

- [ ] テスト/lint が通る
- [ ] コミット履歴が意味単位に分割されている
- [ ] 不要なデバッグコードが残っていない

## Commit Timing（いつコミットするか）

以下のタイミングで即コミット：

1. **動作確認が取れた**とき — 壊れない状態を保護する
2. **方向転換する前** — 戻れるセーブポイントを作る
3. **1つの作業単位が完了した**とき — 中途半端にしない

## Anti-Patterns

- ❌ ブランチを切らずに main で大規模変更
- ❌ 動作確認前にコミット（壊れた状態を保存しない）
- ❌ 長時間コミットしない（クラッシュ時にすべて失う）
- ❌ WIP コミットを大量に積む（後でまとめることを前提にしない）
